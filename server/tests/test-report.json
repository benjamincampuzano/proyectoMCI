{
  "timestamp": "2025-12-30T11:40:39.224Z",
  "summary": {
    "total": 9,
    "passed": 1,
    "failed": 8,
    "successRate": "11.1"
  },
  "results": [
    {
      "file": "test-auth-backend.js",
      "status": "FAILED",
      "duration": 2082,
      "output": "=== PRUEBAS DEL MÓDULO DE AUTENTICACIÓN ===\n\nTest 1: Login con credenciales válidas\n❌ Falló login con credenciales válidas\nResponse: { message: 'Invalid credentials' }\n\nTest 2: Login con credenciales inválidas\n✅ Rechazó correctamente credenciales inválidas\n\nTest 3: Validación de token JWT\n✅ Token JWT generado correctamente\n✅ Token JWT verificado correctamente\n\nTest 4: Verificación de hashing de contraseñas\n✅ Hashing y verificación de contraseñas funciona correctamente\n✅ Rechaza correctamente contraseña incorrecta\n\nTest 5: Validación de campos requeridos en login\n❌ No valida campos requeridos\n\n=== FIN DE PRUEBAS DE AUTENTICACIÓN ===\n"
    },
    {
      "file": "test-users-backend.js",
      "status": "FAILED",
      "duration": 2137,
      "output": "=== PRUEBAS DEL MÓDULO DE USUARIOS ===\n\nTest 1: Obtener todos los usuarios (como ADMIN)\n❌ Falló obtener usuarios\nResponse: { message: 'Server error' }\n\nTest 2: Obtener usuarios con filtro de rol\n❌ Falló filtrar por rol\n\nTest 3: Crear nuevo usuario\n✅ Usuario creado correctamente\n   ID: 26, Email: testuser_1767094826566@test.com\n✅ Usuario de prueba eliminado\n\nTest 4: Validación de email único\n✅ Rechazó correctamente email duplicado\n\nTest 5: Actualizar usuario\n✅ Usuario actualizado correctamente\n✅ Los cambios se guardaron correctamente en la BD\n\nTest 6: Seguridad por rol - LIDER_DOCE solo ve su red\n\nTest 7: Eliminar usuario\nAttempting to delete user 28\nStarting deletion transaction for user 28\nUser 28 deleted successfully\n✅ Usuario eliminado correctamente\n✅ Usuario fue eliminado permanentemente de la BD\n\n=== FIN DE PRUEBAS DE USUARIOS ===\n"
    },
    {
      "file": "test-guests-backend.js",
      "status": "FAILED",
      "duration": 1639,
      "output": "=== PRUEBAS DEL MÓDULO DE INVITADOS ===\n\nTest 1: Obtener todos los invitados (como ADMIN)\n❌ Falló obtener invitados\nResponse: { message: 'Server error' }\n\nTest 2: Crear nuevo invitado\n✅ Invitado creado correctamente\n   ID: 38, Nombre: Invitado de Prueba 1767094828512\n✅ Invitado asignado correctamente al líder\n✅ Invitado de prueba eliminado\n\nTest 3: Validación de campos requeridos\n✅ Valida correctamente campos requeridos\n\nTest 4: Actualizar estado de invitado\n✅ Invitado actualizado correctamente\n✅ El estado se actualizó correctamente en la BD\n\nTest 5: Seguridad por rol - LIDER_DOCE solo ve invitados de su red\n\nTest 6: Asignar invitado a otro usuario\n✅ Invitado asignado correctamente\n✅ La asignación se guardó correctamente en la BD\n\nTest 7: Eliminar invitado\n✅ Invitado eliminado correctamente\n✅ Invitado fue eliminado permanentemente de la BD\n\nTest 8: Estadísticas de invitados\n❌ Error en test de estadísticas: guestController.getGuestStats is not a function\n\n=== FIN DE PRUEBAS DE INVITADOS ===\n"
    },
    {
      "file": "test-cells-backend.js",
      "status": "PASSED",
      "duration": 1974,
      "output": "=== PRUEBAS DEL MÓDULO DE CÉLULAS ===\n\nTest 1: Obtener líderes elegibles (como ADMIN)\n✅ Obtuvo 5 líderes elegibles correctamente\n\nTest 2: Crear nueva célula\nGeocoding successful for Dirección de prueba, Ciudad de prueba, Colombia: 0 0\n✅ Célula creada correctamente\n   ID: 17, Nombre: Célula de Prueba 1767094830545\n✅ Célula asignada correctamente al líder\n✅ Célula de prueba eliminada\n\nTest 3: Validación de campos requeridos\n✅ Valida correctamente campos requeridos\n\nTest 4: Actualizar coordenadas de célula\nGeocoding successful for Dirección de prueba, Ciudad de prueba, Colombia: 0 0\n✅ Coordenadas actualizadas correctamente\n✅ Coordenadas guardadas correctamente en la BD\n\nTest 5: Obtener miembros elegibles (como ADMIN)\n✅ Obtuvo 11 miembros elegibles correctamente\n\nTest 6: Asignar miembro a célula\n✅ Miembro asignado correctamente a la célula\n✅ La asignación se guardó correctamente en la BD\n\nTest 7: Eliminar célula\n✅ Célula eliminada correctamente\n✅ Célula fue eliminada permanentemente de la BD\n\nTest 8: Estadísticas de células\n⚠️  cellController no expone getCellStats actualmente (test omitido)\n\n=== FIN DE PRUEBAS DE CÉLULAS ===\n"
    },
    {
      "file": "test-network-backend.js",
      "status": "FAILED",
      "duration": 1676,
      "output": "=== PRUEBAS DEL MÓDULO DE RED ===\n\nTest 1: Obtener red de un líder\n❌ Falló obtener red\nResponse: { error: 'Error fetching network' }\n\nTest 2: Asignar usuario a líder\n❌ Falló asignar usuario a líder\nResponse: {\n  message: 'Usuario asignado exitosamente',\n  user: {\n    id: 16,\n    fullName: 'Test Discípulo',\n    email: 'test_discipulo@tests.local',\n    role: 'DISCIPULO',\n    pastorId: null,\n    liderDoceId: 3,\n    liderCelulaId: 4\n  }\n}\n\nTest 3: Validación - no se puede asignar líder a ADMIN\n❌ No rechazó asignar ADMIN a líder\n\nTest 4: Remover usuario de la red\n❌ Falló remover usuario de la red\n\nTest 5: Seguridad - PASTOR no puede asignar usuarios\n✅ PASTOR correctamente denegado para asignar usuarios\n\nTest 6: Seguridad - LIDER_CELULA solo puede asignar DISCIPULOS\n❌ LIDER_CELULA no fue denegado para asignar LIDER_DOCE\n❌ LIDER_CELULA no maneja correctamente asignación de DISCIPULO\n\nTest 7: Obtener estadísticas de red\n❌ Error en test de estadísticas de red: networkController.getNetworkStats is not a function\n\nTest 8: Validación de jerarquía - previene ciclos\n❌ No previno ciclo en la jerarquía\n\n=== FIN DE PRUEBAS DE RED ===\n"
    },
    {
      "file": "test-seminars-backend.js",
      "status": "FAILED",
      "duration": 1651,
      "output": "=== PRUEBAS DEL MÓDULO DE SEMINARIOS ===\n\nTest 1: Obtener todos los módulos de seminario\n❌ Falló obtener módulos\nResponse: { error: 'Error fetching modules' }\n\nTest 2: Crear nuevo módulo de seminario\n✅ Módulo creado correctamente\n   ID: 22, Nombre: Módulo de Prueba 1767094833871\n✅ Módulo guardado correctamente en la BD\n✅ Módulo de prueba eliminado\n\nTest 3: Validación de campos requeridos\n✅ Valida correctamente campos requeridos\n\nTest 4: Actualizar módulo\n❌ Falló actualizar módulo\n\nTest 5: Inscribir usuario en módulo\n✅ Usuario inscrito correctamente en el módulo\n✅ La inscripción se guardó correctamente en la BD\n\nTest 6: Validación de duplicación de inscripción\n✅ Rechazó correctamente inscripción duplicada\n\nTest 7: Obtener inscripciones de un módulo\n❌ Falló obtener inscripciones del módulo\nResponse: []\n\nTest 9: Eliminar módulo\n❌ Falló eliminar módulo\n❌ Error en test de eliminar módulo: \nInvalid `prisma.seminarModule.delete()` invocation in\nC:\\Users\\Usuario\\Documents\\Proyecto_Iglesia\\server\\tests\\test-seminars-backend.js:361:46\n\n  358 } else {\n  359     console.log('❌ Falló eliminar módulo');\n  360     // Limpiar manualmente si falló\n→ 361     await prisma.seminarModule.delete(\nAn operation failed because it depends on one or more records that were required but not found. Record to delete does not exist.\n\nTest 10: Estadísticas de seminarios\n⚠️  seminarController no expone getSeminarStats actualmente (test omitido)\n\n=== FIN DE PRUEBAS DE SEMINARIOS ===\n"
    },
    {
      "file": "test-attendance-backend.js",
      "status": "FAILED",
      "duration": 1452,
      "output": "=== PRUEBAS DEL MÓDULO DE ASISTENCIA ===\n\nTest 1: Registrar asistencia a servicio de iglesia\n❌ Falló registrar asistencia a iglesia\nResponse: { error: 'Date and attendances array required' }\n\nTest 2: Validación de duplicación de asistencia a iglesia\n✅ Rechazó correctamente asistencia duplicada\n\nTest 3: Obtener asistencias de iglesia\n❌ Error en test de obtener asistencias: churchAttendanceController.getAttendances is not a function\n\nTest 4: Registrar asistencia a célula\n❌ Error en test de asistencia a célula: cellAttendanceController.recordAttendance is not a function\n\nTest 5: Validación de campos requeridos en asistencia\n✅ Valida correctamente campos requeridos\n\nTest 6: Actualizar asistencia\n❌ Error en test de actualizar asistencia: churchAttendanceController.updateAttendance is not a function\n\nTest 7: Estadísticas de asistencia\n❌ Falló obtener estadísticas de asistencia\n\nTest 8: Seguridad por rol - usuario solo ve sus asistencias\n❌ Error en test de seguridad por rol: churchAttendanceController.getAttendances is not a function\n\nTest 9: Asistencia múltiple (batch)\n⚠️  No hay suficientes discípulos para probar asistencia múltiple\n\nTest 10: Eliminar asistencia\n❌ Error en test de eliminar asistencia: churchAttendanceController.deleteAttendance is not a function\n\n=== FIN DE PRUEBAS DE ASISTENCIA ===\n"
    },
    {
      "file": "test-encuentros-backend.js",
      "status": "FAILED",
      "duration": 2041,
      "output": "=== PRUEBAS DEL MÓDULO DE ENCUENTROS ===\n\nTest 1: Obtener todos los encuentros\n❌ Error en test de obtener encuentros: encuentroController.getAllEncuentros is not a function\n\nTest 2: Crear nuevo encuentro\n❌ Falló crear encuentro\nResponse: {\n  id: 37,\n  type: 'MUJERES',\n  name: 'Encuentro de Prueba 1767094837031',\n  description: 'Descripción de prueba',\n  cost: 100,\n  startDate: 2025-12-30T11:40:37.031Z,\n  endDate: 2026-01-02T11:40:37.031Z,\n  liderDoceIds: [],\n  createdAt: 2025-12-30T11:40:37.241Z,\n  updatedAt: 2025-12-30T11:40:37.241Z\n}\n\nTest 3: Validación de campos requeridos\n❌ No valida campos requeridos\n\nTest 4: Actualizar encuentro\n❌ Falló actualizar encuentro\n\nTest 5: Inscribir invitado en encuentro\n❌ Falló inscribir invitado en encuentro\nResponse: {\n  id: 26,\n  guestId: 42,\n  encuentroId: 39,\n  status: 'REGISTERED',\n  discountPercentage: 10,\n  createdAt: 2025-12-30T11:40:37.508Z,\n  updatedAt: 2025-12-30T11:40:37.508Z,\n  guest: {\n    id: 42,\n    name: 'Invitado para Encuentro 1767094837500',\n    phone: '5554837500',\n    address: null,\n    prayerRequest: null,\n    status: 'NUEVO',\n    called: false,\n    callObservation: null,\n    visited: false,\n    visitObservation: null,\n    invitedById: 12,\n    assignedToId: null,\n    createdAt: 2025-12-30T11:40:37.502Z,\n    updatedAt: 2025-12-30T11:40:37.502Z\n  }\n}\n\nTest 6: Validación de duplicación de inscripción\n✅ Rechazó correctamente inscripción duplicada\n\nTest 7: Registrar asistencia a clase de encuentro\n❌ Error en test de registrar asistencia: encuentroController.recordClassAttendance is not a function\n\nTest 8: Obtener inscripciones de un encuentro\n❌ Error en test de obtener inscripciones: encuentroController.getEncuentroRegistrations is not a function\n\nTest 9: Eliminar encuentro\n❌ Falló eliminar encuentro\n❌ Error en test de eliminar encuentro: \nInvalid `prisma.encuentro.delete()` invocation in\nC:\\Users\\Usuario\\Documents\\Proyecto_Iglesia\\server\\tests\\test-encuentros-backend.js:476:42\n\n  473 } else {\n  474     console.log('❌ Falló eliminar encuentro');\n  475     // Limpiar manualmente si falló\n→ 476     await prisma.encuentro.delete(\nAn operation failed because it depends on one or more records that were required but not found. Record to delete does not exist.\n\nTest 10: Estadísticas de encuentros\n❌ Error en test de estadísticas de encuentros: encuentroController.getEncuentroStats is not a function\n\n=== FIN DE PRUEBAS DE ENCUENTROS ===\n"
    },
    {
      "file": "test-conventions-backend.js",
      "status": "FAILED",
      "duration": 1532,
      "output": "=== PRUEBAS DEL MÓDULO DE CONVENCIONES ===\n\nTest 1: Obtener todas las convenciones\n❌ Error en test de obtener convenciones: conventionController.getAllConventions is not a function\n\nTest 2: Crear nueva convención\n❌ Falló crear convención\nResponse: { error: 'Convention FAMILIAS 2025 already exists' }\n\nTest 3: Validación de campos requeridos\n❌ No valida campos requeridos\n\nTest 4: Validación de duplicación (mismo tipo y año)\n❌ Error en test de duplicación: \nInvalid `prisma.convention.create()` invocation in\nC:\\Users\\Usuario\\Documents\\Proyecto_Iglesia\\server\\tests\\test-conventions-backend.js:143:33\n\n  140 const currentYear = new Date().getFullYear();\n  141 \n  142 // Primera convención\n→ 143 await prisma.convention.create(\nUnique constraint failed on the fields: (`type`,`year`)\n\nTest 5: Actualizar convención\n❌ Error en test de actualizar convención: \nInvalid `prisma.convention.create()` invocation in\nC:\\Users\\Usuario\\Documents\\Proyecto_Iglesia\\server\\tests\\test-conventions-backend.js:187:56\n\n  184 });\n  185 \n  186 // Crear convención para actualizar\n→ 187 const testConvention = await prisma.convention.create(\nUnique constraint failed on the fields: (`type`,`year`)\n\nTest 6: Inscribir usuario en convención\n❌ Error en test de inscripción: \nInvalid `prisma.convention.create()` invocation in\nC:\\Users\\Usuario\\Documents\\Proyecto_Iglesia\\server\\tests\\test-conventions-backend.js:241:56\n\n  238 });\n  239 \n  240 // Crear convención para inscripción\n→ 241 const testConvention = await prisma.convention.create(\nUnique constraint failed on the fields: (`type`,`year`)\n\nTest 7: Validación de duplicación de inscripción\n❌ Error en test de duplicación: \nInvalid `prisma.convention.create()` invocation in\nC:\\Users\\Usuario\\Documents\\Proyecto_Iglesia\\server\\tests\\test-conventions-backend.js:305:56\n\n  302 });\n  303 \n  304 // Crear convención\n→ 305 const testConvention = await prisma.convention.create(\nUnique constraint failed on the fields: (`type`,`year`)\n\nTest 8: Obtener inscripciones de una convención\n❌ Error en test de obtener inscripciones: \nInvalid `prisma.convention.create()` invocation in\nC:\\Users\\Usuario\\Documents\\Proyecto_Iglesia\\server\\tests\\test-conventions-backend.js:354:56\n\n  351 });\n  352 \n  353 // Crear convención con inscripciones\n→ 354 const testConvention = await prisma.convention.create(\nUnique constraint failed on the fields: (`type`,`year`)\n\nTest 9: Registrar pago de convención\n❌ Error en test de registrar pago: \nInvalid `prisma.convention.create()` invocation in\nC:\\Users\\Usuario\\Documents\\Proyecto_Iglesia\\server\\tests\\test-conventions-backend.js:402:56\n\n  399 });\n  400 \n  401 // Crear convención e inscripción\n→ 402 const testConvention = await prisma.convention.create(\nUnique constraint failed on the fields: (`type`,`year`)\n\nTest 10: Eliminar convención\n❌ Error en test de eliminar convención: \nInvalid `prisma.convention.create()` invocation in\nC:\\Users\\Usuario\\Documents\\Proyecto_Iglesia\\server\\tests\\test-conventions-backend.js:465:56\n\n  462 });\n  463 \n  464 // Crear convención para eliminar\n→ 465 const testConvention = await prisma.convention.create(\nUnique constraint failed on the fields: (`type`,`year`)\n\nTest 11: Estadísticas de convenciones\n❌ Error en test de estadísticas de convenciones: conventionController.getConventionStats is not a function\n\n=== FIN DE PRUEBAS DE CONVENCIONES ===\n"
    }
  ]
}